<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Python Compiler</title>

    <!-- CodeMirror Core -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/theme/dracula.min.css">

    <!-- CodeMirror Addons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/hint/show-hint.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/addon/hint/python-hint.min.js"></script>

    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #1e1e1e;
            color: #f1f1f1;
        }

        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #2b2b2b;
            border-radius: 10px;
            box-shadow: 0 0 10px #111;
        }

        h1 {
            text-align: center;
            color: #00e676;
        }

        label {
            font-weight: bold;
        }

        textarea, .CodeMirror {
            width: 100%;
            font-size: 16px;
            border-radius: 6px;
            box-sizing: border-box;
        }

        .section {
            margin: 20px 0;
        }

        #userInput {
            display: none;
            height: 100px;
        }

        button {
            background-color: #00e676;
            color: #000;
            padding: 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #00c853;
        }

        #output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            white-space: pre-wrap;
            border-radius: 6px;
            border: 1px solid #444;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Python Compiler</h1>

    <form id="codeForm">
        <div class="section">
            <label for="code">Write your Python code:</label>
            <textarea id="code"># write the code here</textarea>
        </div>

        <div class="section">
            <label for="userInput">Input (if required):</label>
            <textarea id="userInput" placeholder="Enter input here..."></textarea>
        </div>

        <button type="submit">â–¶ Run Code</button>
    </form>

    <div class="section">
        <h3>Output:</h3>
        <pre id="output">Output will appear here...</pre>
    </div>
</div>

<script>
    const editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        mode: "python",
        theme: "dracula",
        indentUnit: 4,
        tabSize: 4,
        autoCloseBrackets: true,
        matchBrackets: true,
        extraKeys: {
            "Ctrl-Space": "autocomplete"
        }
    });

    const form = document.getElementById("codeForm");
    const outputBox = document.getElementById("output");
    const userInputBox = document.getElementById("userInput");
    let needsInput = false;

    editor.on("inputRead", function(cm, change) {
        if (change.text[0].match(/[\w\.]/)) {
            cm.showHint({completeSingle: false});
        }
    });

    form.addEventListener("submit", async function (e) {
        e.preventDefault();
        const code = editor.getValue();

        // Show input field if input() is found
        if (code.includes("input(") && !needsInput) {
            userInputBox.style.display = "block";
            userInputBox.focus();
            needsInput = true;
            return;
        }

        const input = userInputBox.value;

        const response = await fetch("/run", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ code, input })
        });

        const data = await response.json();
        outputBox.textContent = data.output || "No output.";

        // Reset input box
        userInputBox.value = "";
        userInputBox.style.display = "none";
        needsInput = false;
    });
</script>
</body>
</html>
